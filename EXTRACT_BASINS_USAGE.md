# æŒ‰ multi_task_lstm.py é€»è¾‘æå–æµåŸŸID - ä½¿ç”¨è¯´æ˜

## è„šæœ¬è¯´æ˜

`extract_basins_by_logic.py` ä¼šæŒ‰ç…§ `multi_task_lstm.py` çš„å®é™…é€‰æ‹©é€»è¾‘æå–æµåŸŸIDåˆ—è¡¨ï¼Œ**ä½ å¯ä»¥è‡ªå·±æŒ‡å®šæå–çš„æ•°é‡**ã€‚

## æ ¸å¿ƒé€»è¾‘

è¯¥è„šæœ¬å®Œå…¨éµå¾ª `multi_task_lstm.py` ä¸­çš„æµåŸŸé€‰æ‹©é€»è¾‘ï¼š

1. ä» `valid_waterlevel_basins.txt` è¯»å–å€™é€‰æµåŸŸåˆ—è¡¨ï¼ˆå…±5767ä¸ªï¼‰
2. `multi_task_lstm.py` å®é™…è¿è¡Œæ—¶ä¼šéªŒè¯æ¯ä¸ªæµåŸŸï¼š
   - åŒæ—¶æœ‰æœ‰æ•ˆçš„å¾„æµå’Œæ°´ä½æ•°æ®
   - æœ‰æ•ˆæ•°æ®æ¯”ä¾‹ â‰¥ 10%
   - æ•°æ®ä¸å…¨ä¸ºNaN
3. ä»éªŒè¯é€šè¿‡çš„æµåŸŸä¸­é€‰æ‹©å‰ `NUM_BASINS` ä¸ª

**æœ¬è„šæœ¬çš„åšæ³•**ï¼š
- ä¸è¿è¡Œå®é™…çš„æ•°æ®éªŒè¯ï¼ˆé¿å…ç¯å¢ƒ/è·¯å¾„é—®é¢˜ï¼‰
- ç›´æ¥ä»å€™é€‰åˆ—è¡¨æå–å‰ N ä¸ªæµåŸŸID
- å‡è®¾å€™é€‰åˆ—è¡¨å·²æŒ‰å¯ç”¨æ€§æ’åº

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æå–100ä¸ªæµåŸŸï¼ˆé»˜è®¤è®­ç»ƒé…ç½®ï¼‰
python extract_basins_by_logic.py --num 100

# æå–200ä¸ªæµåŸŸ
python extract_basins_by_logic.py --num 200

# æå–1000ä¸ªæµåŸŸ
python extract_basins_by_logic.py --num 1000

# æå–æ‰€æœ‰å€™é€‰æµåŸŸï¼ˆ5767ä¸ªï¼‰
python extract_basins_by_logic.py --num 5767
```

### é«˜çº§ç”¨æ³•

```bash
# æŒ‡å®šè¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºå‰ç¼€
python extract_basins_by_logic.py \
    --num 500 \
    --input valid_waterlevel_basins.txt \
    --output-prefix my_basins

# æŸ¥çœ‹å¸®åŠ©
python extract_basins_by_logic.py --help
```

## å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `--num` | æ˜¯ | è¦æå–çš„æµåŸŸæ•°é‡ | `100`, `200`, `1000` |
| `--input` | å¦ | å€™é€‰æµåŸŸåˆ—è¡¨æ–‡ä»¶ | `valid_waterlevel_basins.txt` |
| `--output-prefix` | å¦ | è¾“å‡ºæ–‡ä»¶åå‰ç¼€ | `extracted_basin_ids` |

## è¾“å‡ºæ–‡ä»¶

æ¯æ¬¡è¿è¡Œä¼šç”Ÿæˆ4ä¸ªæ–‡ä»¶ï¼ˆä»¥ `--num 200` ä¸ºä¾‹ï¼‰ï¼š

### 1. `extracted_basin_ids_200.txt`
**æ ¼å¼**: Pythonåˆ—è¡¨  
**ç”¨é€”**: å¯ç›´æ¥å¤åˆ¶åˆ°ä»£ç ä¸­

```python
BASIN_IDS = [
    '01011000',
    '01013500',
    '01015800',
    # ... å…±200ä¸ª
]
```

### 2. `extracted_basin_ids_200_simple.txt`
**æ ¼å¼**: çº¯æ–‡æœ¬ï¼Œæ¯è¡Œä¸€ä¸ªID  
**ç”¨é€”**: ä¾¿äºå…¶ä»–ç¨‹åºè¯»å–

```
01011000
01013500
01015800
...
```

### 3. `extracted_basin_ids_200.csv`
**æ ¼å¼**: CSVæ–‡ä»¶  
**ç”¨é€”**: Excelæˆ–pandasè¯»å–

```csv
basin_id,index
01011000,0
01013500,1
01015800,2
...
```

### 4. `extracted_basin_ids_200_report.txt`
**æ ¼å¼**: è¯¦ç»†æŠ¥å‘Š  
**ç”¨é€”**: æŸ¥çœ‹æå–ä¿¡æ¯å’Œå®Œæ•´åˆ—è¡¨

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä¸ºè®­ç»ƒå‡†å¤‡100ä¸ªæµåŸŸ

```bash
python extract_basins_by_logic.py --num 100
```

**è¾“å‡º**:
- `extracted_basin_ids_100.txt`
- `extracted_basin_ids_100_simple.txt`
- `extracted_basin_ids_100.csv`
- `extracted_basin_ids_100_report.txt`

**ä½¿ç”¨**:
```python
# åœ¨ä½ çš„è„šæœ¬ä¸­
from extracted_basin_ids_100 import BASIN_IDS
print(f"ä½¿ç”¨ {len(BASIN_IDS)} ä¸ªæµåŸŸ")
```

### ç¤ºä¾‹2: æå–1000ä¸ªæµåŸŸç”¨äºå¤§è§„æ¨¡å®éªŒ

```bash
python extract_basins_by_logic.py --num 1000
```

**è¯´æ˜**:
- å€™é€‰æ€»æ•°: 5767ä¸ª
- æå–æ•°é‡: 1000ä¸ª
- æ¥è‡ª `valid_waterlevel_basins.txt` çš„å‰1000ä¸ª

### ç¤ºä¾‹3: è‡ªå®šä¹‰è¾“å‡ºå‰ç¼€

```bash
python extract_basins_by_logic.py --num 500 --output-prefix my_experiment
```

**è¾“å‡º**:
- `my_experiment_500.txt`
- `my_experiment_500_simple.txt`
- `my_experiment_500.csv`
- `my_experiment_500_report.txt`

## é‡è¦è¯´æ˜

### âš ï¸ å…³äºæ•°æ®éªŒè¯

**è„šæœ¬ä¸è¿è¡Œå®é™…çš„æ•°æ®éªŒè¯**ï¼ŒåŸå› ï¼š
1. é¿å…è·¯å¾„é…ç½®é—®é¢˜ï¼ˆCAMELSH_DATA_PATHï¼‰
2. é¿å…ç¯å¢ƒä¾èµ–é—®é¢˜
3. æä¾›å¿«é€Ÿçš„æµåŸŸIDåˆ—è¡¨

**å®é™…ä½¿ç”¨æ—¶**ï¼š
- `multi_task_lstm.py` ä¼šéªŒè¯æ¯ä¸ªæµåŸŸçš„æ•°æ®
- åªæœ‰éªŒè¯é€šè¿‡çš„æµåŸŸæ‰ä¼šè¢«ä½¿ç”¨
- **æœ€ç»ˆä½¿ç”¨çš„æµåŸŸæ•°é‡å¯èƒ½å°‘äºä½ æŒ‡å®šçš„æ•°é‡**

### ğŸ“Š å€™é€‰æµåŸŸç»Ÿè®¡

ä» `valid_waterlevel_basins.txt`:
- æ€»å€™é€‰æ•°é‡: **5767ä¸ª**
- è¿™äº›æµåŸŸéƒ½æœ‰æ°´ä½æ•°æ®æ–‡ä»¶
- ä½†ä¸æ˜¯æ‰€æœ‰æµåŸŸéƒ½æœ‰æœ‰æ•ˆçš„å¾„æµå’Œæ°´ä½æ•°æ®

### ğŸ” éªŒè¯æå–ç»“æœ

è¿è¡Œ `multi_task_lstm.py` åï¼Œå¯ä»¥å¯¹æ¯”ï¼š

```bash
# ä½ æå–çš„æµåŸŸ
extracted_basin_ids_200.csv  (200ä¸ª)

# å®é™…ä½¿ç”¨çš„æµåŸŸ
runtime_basins.csv  (å¯èƒ½å°‘äº200ä¸ª)
```

å·®å¼‚åŸå› ï¼š
- æŸäº›æµåŸŸæ•°æ®éªŒè¯å¤±è´¥
- æ•°æ®æœ‰æ•ˆæ€§ä¸è¶³ï¼ˆ< 10%ï¼‰
- æ•°æ®å…¨ä¸ºNaN

## ä¸å…¶ä»–è„šæœ¬çš„å¯¹æ¯”

| è„šæœ¬ | æ•°æ®æ¥æº | æ˜¯å¦éªŒè¯ | æµåŸŸæ•°é‡ | ç”¨é€” |
|------|----------|----------|----------|------|
| `extract_basins_by_logic.py` | å€™é€‰åˆ—è¡¨ | âŒ | **å¯è‡ªå®šä¹‰** | å¿«é€Ÿç”Ÿæˆå€™é€‰ID |
| `extract_per_basin_config.py` | å®é™…è¿è¡Œ | âœ… | å®é™…ä½¿ç”¨ | æå–è¿è¡Œæ—¶é…ç½® |
| `runtime_basins.csv` | è¿è¡Œç»“æœ | âœ… | 100 | å®é™…è®­ç»ƒæµåŸŸ |

## æ¨èå·¥ä½œæµ

### æ–¹æ¡ˆA: å¿«é€Ÿå¼€å§‹ï¼ˆä½¿ç”¨æœ¬è„šæœ¬ï¼‰

```bash
# 1. æå–å€™é€‰æµåŸŸID
python extract_basins_by_logic.py --num 200

# 2. åœ¨ä»£ç ä¸­ä½¿ç”¨
# config.py: NUM_BASINS = 200

# 3. è¿è¡Œè®­ç»ƒ
python multi_task_lstm.py

# 4. æŸ¥çœ‹å®é™…ä½¿ç”¨çš„æµåŸŸ
# runtime_basins.csv (å¯èƒ½åªæœ‰150ä¸ªéªŒè¯é€šè¿‡)
```

### æ–¹æ¡ˆB: ç²¾ç¡®é…ç½®ï¼ˆè¿è¡Œåæå–ï¼‰

```bash
# 1. å…ˆè¿è¡Œä¸€æ¬¡è®­ç»ƒ
# config.py: NUM_BASINS = 200
python multi_task_lstm.py

# 2. æå–å®é™…ä½¿ç”¨çš„æµåŸŸé…ç½®
python extract_per_basin_config.py

# 3. æŸ¥çœ‹ç»“æœ
# runtime_basins.csv - å®é™…ä½¿ç”¨çš„æµåŸŸID
# runtime_basin_time_ranges_simple.csv - æ¯ä¸ªæµåŸŸçš„æ—¶é—´èŒƒå›´
```

## FAQ

### Q1: ä¸ºä»€ä¹ˆä¸ç›´æ¥è¿è¡Œæ•°æ®éªŒè¯ï¼Ÿ

**A**: ä¸ºäº†ï¼š
1. é¿å…ç¯å¢ƒé…ç½®é—®é¢˜ï¼ˆCAMELSHè·¯å¾„ã€ä¾èµ–åº“ç­‰ï¼‰
2. æä¾›å¿«é€Ÿçš„æµåŸŸIDæå–
3. ä½ å¯ä»¥éšæ„æŒ‡å®šæ•°é‡è€Œä¸ç”¨ç­‰å¾…éªŒè¯

### Q2: æå–çš„æµåŸŸIDæ˜¯å¦å¯é ï¼Ÿ

**A**: 
- ä» `valid_waterlevel_basins.txt` æå–ï¼Œè¿™äº›æµåŸŸéƒ½æœ‰æ°´ä½æ•°æ®æ–‡ä»¶
- å€™é€‰åˆ—è¡¨é€šå¸¸æŒ‰å¯ç”¨æ€§æ’åºï¼Œé å‰çš„æµåŸŸæ›´å¯èƒ½æœ‰æ•ˆ
- **å»ºè®®**: å®é™…ä½¿ç”¨å‰è¿è¡Œä¸€æ¬¡ `multi_task_lstm.py` éªŒè¯

### Q3: å¦‚ä½•çŸ¥é“å®é™…æœ‰å¤šå°‘æµåŸŸé€šè¿‡éªŒè¯ï¼Ÿ

**A**: è¿è¡Œ `multi_task_lstm.py` åæŸ¥çœ‹ï¼š
```bash
# æŸ¥çœ‹å®é™…ä½¿ç”¨çš„æµåŸŸæ•°é‡
wc -l runtime_basins.csv  # Linux/Mac
# æˆ–åœ¨Pythonä¸­
import pandas as pd
df = pd.read_csv('runtime_basins.csv')
print(f"å®é™…ä½¿ç”¨: {len(df)} ä¸ªæµåŸŸ")
```

### Q4: å¯ä»¥æå–è¶…è¿‡5767ä¸ªæµåŸŸå—ï¼Ÿ

**A**: ä¸èƒ½ã€‚å€™é€‰åˆ—è¡¨æ€»å…±5767ä¸ªæµåŸŸï¼Œè¿™æ˜¯ä¸Šé™ã€‚

### Q5: ä¸åŒæ•°é‡çš„æå–ç»“æœæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ

**A**: 
- 100ä¸ªæµåŸŸ = å‰100ä¸ª
- 200ä¸ªæµåŸŸ = å‰200ä¸ªï¼ˆåŒ…å«å‰100ä¸ªï¼‰
- 1000ä¸ªæµåŸŸ = å‰1000ä¸ªï¼ˆåŒ…å«å‰100å’Œå‰200ï¼‰

å®ƒä»¬æ˜¯é€’è¿›å…³ç³»ï¼Œä¸æ˜¯ç‹¬ç«‹çš„ã€‚

---

**åˆ›å»ºæ—¶é—´**: 2026-01-17  
**è„šæœ¬ç‰ˆæœ¬**: 1.0  
**å€™é€‰æµåŸŸæ€»æ•°**: 5767
